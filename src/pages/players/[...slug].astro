---
export const prerender = false;
import BackgroundImage from "../../components/cosmetic/BackgroundImage.astro";
import Layout from "../../layouts/Layout.astro";
import PlayerCard from "../../components/information/PlayerCard.astro";
import SponsorStatsCard from "../../components/information/SponsorStatsCard.astro";
import MapStatsCard from "../../components/information/MapStatsCard.astro";
import MatchHistory from "../../components/information/MatchHistory.svelte";
import LoadingSpinner from "../../components/cosmetic/LoadingSpinner.astro";

const { slug } = Astro.params;
const playerId = slug;

let playerFullProfile;
let isLoading = true;

try {
	const response = await fetch(
		`https://wavescan-production.up.railway.app/api/v1/player/${playerId}/full_profile`,
	);
	playerFullProfile = await response.json();
} catch (error) {
	console.error("Error fetching player data:", error);
} finally {
	isLoading = false;
}
---

<Layout pageTitle={playerFullProfile ? "Santai.GG | " + playerFullProfile.name : "Loading..."}>
  <main class="p-4">
    <BackgroundImage imagePath="/src/assets/background-03.jpg" altText="Spectre Divide - player aiming a revolver." />
    <div class="max-w-screen-xl mx-auto">
      {isLoading ? (
        <div class="flex justify-center items-center h-screen">
          <LoadingSpinner />
        </div>
      ) : (
        <div class="flex flex-col md:flex-row md:space-x-2">
          <div class="md:w-1/4 space-y-4 md:sticky md:top-4 md:self-start">
            <PlayerCard player={playerFullProfile} />
            <SponsorStatsCard sponsorStats={playerFullProfile?.extended_stats?.sponsor_stats || {}} />
            <MapStatsCard mapStats={playerFullProfile?.extended_stats?.map_stats || {}} />
          </div>
          <div class="md:w-3/4 mt-4 md:mt-0">
            <MatchHistory playerFullProfile={playerFullProfile} client:load />
          </div>
        </div>
      )}
    </div>
  </main>
</Layout>

<style>
  @media (min-width: 768px) {
    main {
      min-height: 100vh;
    }
  }
</style>